<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./../../Template.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="titulo">
        Novo Gráfico saida
    </ui:define>

    <ui:define name="imports">
        <script type="text/javascript" src="../../resources/scripts/script.js"></script>
    </ui:define>

    <ui:define name="centro">

        <div id="breu" class="breu" ></div>
        <h:form id="graficoSaida" prependId="false">
            <p:growl id="messages" autoUpdate="true"  />
            <div style="position: absolute; margin-left: 455px; margin-top: 7px;  " >
                <p:commandLink action="#{boleanos.ambosTrue(5)}" rendered="#{listaDeGraficosSaidaSalvos.confereSeABSGrafSaidaSalvoJahTahSalvo()}" oncomplete="breuOn();abreJanela5();iniciaAlinhamentoBurro();" update="configGrafManipulado" >
                    <h:graphicImage id="manipulandoGrafico"  library="imagens"  name="gear.png"/>
                    <p:tooltip for="manipulandoGrafico" value='vc está manipulando "#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}"' showEffect="fade" hideEffect="fade" />  
                </p:commandLink>
            </div>
            <p:wizard step="#{graficoSaida.stepWizr}" showNavBar="false" showStepStatus="true" >
                <!--ARQUIVADOS-->
                <p:tab title="Consutas salvas" id="arquivados"  >
                    <p:panel header="Graficos Salvos  " >
                        <table>
                            <tr>
                                <td>Nome</td>
                                <td>
                                    <p:autoComplete maxResults="10" value="#{listaDeGraficosSaidaSalvos.nome}" completeMethod="#{listaDeGraficosSaidaSalvos.autoComplete}"   />
                                </td>
                            </tr>
                            <tr>
                                <td>Tipo</td>
                                <td><p:selectOneRadio value="#{listaDeGraficosSaidaSalvos.exibePorTipo}" layout="pageDirection"   >  
                                        <f:selectItem itemLabel="Pré Determinado" itemValue="1" />   
                                        <f:selectItem itemLabel="Custom" itemValue="2" />  
                                        <f:selectItem itemLabel="Ambos" itemValue="3" />  
                                    </p:selectOneRadio> </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td><p:commandButton value="Buscar" actionListener="#{listaDeGraficosSaidaSalvos.filtra(true)}" update="graficoSaida" /> </td>
                            </tr>
                        </table>
                        <br></br>
                        <p:dataTable id="listaDeGraficosSalvos" paginator="true" rows="3" emptyMessage="Sem resultados"
                                     paginatorTemplate="  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="3,5,10,15,30"  var="grafico" value="#{listaDeGraficosSaidaSalvos.graficosSaidaSalvosManipulados}" >
                            <f:facet name="header">  
                                Gráficos salvos
                            </f:facet>
                            <p:column > 
                                <div class="espacamento">
                                    <br></br>
                                    <p:fieldset collapsed="true"  toggleable="true" legend=' "#{grafico.nome}" - #{utilData.dataFormal2(grafico.dataModificado.time)} - id: #{grafico.id} '
                                                toggleSpeed="#{boleanos.timeDefault*2}">
                                        <br></br>
                                        <p:dataTable var="exibindoGrafico" value="#{utilLista.recebeObjetoRetornaLista(grafico)}">
                                            <p:column>  
                                                <f:facet name="header" >  
                                                    <div class="cabecaTablea">Periodo</div>
                                                </f:facet>
                                                <div class="espacamento" >
                                                    De: #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaLong(exibindoGrafico.de.time, exibindoGrafico.agrupamento)}
                                                    <br> 
                                                        Até: #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaLong(exibindoGrafico.ate.time, exibindoGrafico.agrupamento)}
                                                    </br>
                                                </div>
                                            </p:column>



                                            <p:column>  
                                                <f:facet name="header" >  
                                                    <div class="cabecaTablea">Agrupamento</div>
                                                </f:facet>
                                                <div class="espacamento" > 
                                                    #{exibindoGrafico.agrupamento}
                                                </div>
                                            </p:column>



                                            <p:column>  
                                                <f:facet name="header" >  
                                                    <div class="cabecaTablea">Pontos</div>
                                                </f:facet>
                                                <div class="espacamento" > 
                                                    <p:accordionPanel activeIndex="-1" style="width: 100%; " >
                                                        <p:tab title="Ver pontos"  >
                                                            <p:dataTable var="q" value="#{listaDeGraficosSaidaSalvos.listaPontosDeGraficoSalvo(exibindoGrafico)}"  style="width:100%; text-align: center" >
                                                                <p:column style="border: 0px;"  >
                                                                    <h:outputText value="#{q.nome}" />
                                                                </p:column>
                                                            </p:dataTable>
                                                        </p:tab>
                                                    </p:accordionPanel>
                                                </div>
                                            </p:column>



                                            <p:column>  
                                                <f:facet name="header" >  
                                                    <div class="cabecaTablea">Produtos</div>
                                                </f:facet>
                                                <div class="espacamento" > 

                                                    <p:accordionPanel activeIndex="-1" style="width: 100%; " >
                                                        <p:tab title="Ver produtos"  >
                                                            <p:dataTable var="q" value="#{listaDeGraficosSaidaSalvos.listaProdutosDeGraficoSalvo(exibindoGrafico)}"  style="width:100%; text-align: center" >
                                                                <p:column style="border: 0px;"  >
                                                                    <h:outputText value="#{q.toString()}" />
                                                                </p:column>
                                                            </p:dataTable>
                                                        </p:tab>
                                                    </p:accordionPanel>
                                                </div>
                                            </p:column>
                                        </p:dataTable>
                                        <br></br>

                                        <p:commandLink update="deletaGraf" action="#{boleanos.ambosTrue(0)}" oncomplete="breuOn();abreJanela0();" style="float: right; margin-left: 10px;"  >
                                            <p:tooltip for="imagemDeltarGrafico" value="Deleta gráfico" />
                                            <h:graphicImage id="imagemDeltarGrafico" library="imagens" name="delete.png" styleClass="imagens"  />
                                            <f:setPropertyActionListener value="#{grafico}" target="#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerDeletado}" />
                                        </p:commandLink>

                                        <p:commandLink  update="graficoSaida" style="float: right; " action="#{graficoSaida.carregaGrafico(listaDeGraficosSaidaSalvos.listaPontosDeGraficoSalvo(grafico), listaDeGraficosSaidaSalvos.listaProdutosDeGraficoSalvo(grafico), grafico)}" >
                                            <p:tooltip for="imagemVisualizarGrafico" value="Visualizar gráfico" />
                                            <h:graphicImage id="imagemVisualizarGrafico" library="imagens" name="chart32.png" styleClass="imagens"  />
                                            <f:setPropertyActionListener value="#{listaDeGraficosSaidaSalvos.listaPontosDeGraficoSalvo(grafico)}" target="#{listaDePontos.pontosManipulados}"/>
                                            <f:setPropertyActionListener value="#{listaDeGraficosSaidaSalvos.listaProdutosDeGraficoSalvo(grafico)}" target="#{listaDeProdutos.produtosManipulados}"/>
                                            <f:setPropertyActionListener value="#{grafico}" target="#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo2}" />
                                        </p:commandLink>

                                    </p:fieldset>
                                    <br></br>
                                </div>
                            </p:column>
                        </p:dataTable>
                        <p:separator style="width: 100%; height: 5px;"/>
                        <div class="wizard">
                            <div class="wizardNext">
                                <p:commandButton image="avancar" action="#{graficoSaida.navegaNoWizard(0)}" update="graficoSaida" />
                            </div>
                        </div> 
                    </p:panel>
                </p:tab>
                <!--DATA-->
                <p:tab title="Data" id="data"  >
                    <p:panel header="Definindo data">
                        <p:accordionPanel activeIndex="#{graficoSaida.tipoDeConsulta}" >
                            <p:tab title="Consulta Pré-Determinada" >
                                <table style="margin: 0 auto;"  >
                                    <tr>
                                        <td class="alingRight" >De</td>
                                        <td><p:calendar  showButtonPanel="true" navigator="true" converter="converteDataDiaMesAno" pattern="dd/MM/yyyy" value="#{listaDeGraficosSaidaSalvos.grafSaidaPreDet.de}" /></td>
                                    </tr>
                                    <tr>
                                        <td class="alingRight" >Até</td>
                                        <td><p:calendar  showButtonPanel="true" navigator="true" converter="converteDataDiaMesAno" maxdate="#{utilData.hoje()}" pattern="dd/MM/yyyy" value="#{listaDeGraficosSaidaSalvos.grafSaidaPreDet.ate}" /></td>
                                    </tr>
                                    <tr>
                                        <td class="alingRight" ><h:outputText value="Agrupar a pesquisa por"/></td>
                                        <td>
                                            <p:selectOneMenu value="#{listaDeGraficosSaidaSalvos.grafSaidaPreDet.agrupamento}"  style="width: 250px;"  >
                                                <f:selectItems value="#{agrupamento.agrupamentoPredeterminado()}" var="pt" itemValue="#{pt}" itemLabel="#{pt}" />
                                            </p:selectOneMenu>
                                        </td>
                                    </tr>
                                </table>
                            </p:tab>
                            <p:tab title="Consulta Customizável" >
                                <table style="margin: 0 auto;">
                                    <tr>
                                        <td class="alingRight" >De</td>
                                        <td><p:calendar converter="converteDataDiaMesAno" converterMessage="tá certo essa data ai?" pattern="dd/MM/yyyy" value="#{listaDeGraficosSaidaSalvos.grafSaidaCustom.de}" /></td>
                                    </tr>
                                    <tr>
                                        <td class="alingRight" >Até</td>
                                        <td><p:calendar converter="converteDataDiaMesAno" maxdate="#{utilData.hoje()}" converterMessage="tá certo essa data ai?" pattern="dd/MM/yyyy" value="#{listaDeGraficosSaidaSalvos.grafSaidaCustom.ate}" /></td>
                                    </tr>
                                    <tr>
                                        <td class="alingRight" ><h:outputText value="Agrupar a pesquisa por "/></td>
                                        <td>
                                            <p:selectOneMenu value="#{listaDeGraficosSaidaSalvos.grafSaidaCustom.agrupamento}"  style="width: 250px;"  >
                                                <f:selectItems value="#{agrupamento.agrupamentoCustom()}" var="pt" itemValue="#{pt}" itemLabel="#{pt}" />
                                            </p:selectOneMenu>
                                        </td>
                                    </tr>
                                </table>
                            </p:tab>
                        </p:accordionPanel>
                        <p:separator style="width: 100%; height: 5px;"/>
                        <div class="wizard">
                            <div class="wizardNext">
                                <p:commandButton image="avancar" title="Avançar"  action="#{graficoSaida.confereData(listaDeGraficosSaidaSalvos)}" update="graficoSaida"  />
                            </div>
                            <div class="wizardBack">
                                <p:commandButton image="voltar" title="Voltar" action="#{graficoSaida.navegaNoWizard(2)}"  update="graficoSaida" />
                            </div> 
                        </div> 
                    </p:panel>
                </p:tab>
                <!--PRODUTOS-->
                <p:tab title="Produtos" id="produtos" >
                    <p:panel header="Definindo os produtos">
                        <table>
                            <tr>
                                <td>Produto</td>
                                <td>
                                    <p:selectOneMenu value="#{listaDeProdutos.indexDoProduto}" style="min-width: 230px;" >
                                        <f:selectItems value="#{listaDeProdutos.produtos}" var="p"
                                                       itemLabel="#{p.toString()}" itemValue="#{listaDeProdutos.produtos.indexOf(p)}"/>
                                    </p:selectOneMenu>
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td><p:commandButton value="Adicionar" action="#{listaDeProdutos.desce()}" update="graficoSaida" >
                                    </p:commandButton> </td>
                            </tr>
                        </table>
                        <p:dataTable  var="p" value="#{listaDeProdutos.produtosManipulados}" 
                                      paginator="true" rows="10" emptyMessage="Sem resultados"
                                      paginatorTemplate="  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                      rowsPerPageTemplate="5,10,15,30"  >
                            <f:facet name="header" >
                                Lista de produtos
                            </f:facet>


                            <p:column>  
                                <f:facet name="header" >  
                                    <div class="cabecaTablea">Produto</div>
                                </f:facet>
                                <div class="espacamento" >
                                    <h:outputText value="#{p.toString()}" />
                                </div>
                            </p:column>



                            <p:column>  
                                <f:facet name="header" >  
                                    <div class="cabecaTablea">Remover</div>
                                </f:facet>
                                <div class="espacamento" style="text-align: center" >
                                    <p:commandLink action="#{boleanos.ambosTrue(1)}" oncomplete="breuOn();abreJanela1();" update="removeProduto" >
                                        <h:graphicImage id="imagemRemoverPrdoduto" library="imagens" styleClass="imagens" name="delete.png" />
                                        <p:tooltip for="imagemRemoverPrdoduto" value="Remover produto da lista" />
                                        <f:setPropertyActionListener value="#{listaDeProdutos.produtosManipulados.indexOf(p)}" target="#{listaDeProdutos.indexDoProdutoManipulado}" />
                                    </p:commandLink>
                                </div>
                            </p:column>
                        </p:dataTable>
                        <p:separator style="width: 100%; height: 5px;"/>
                        <div class="wizard">
                            <div class="wizardNext">
                                <p:commandButton image="avancar" title="Avançar" action="#{graficoSaida.confereProdutos(listaDeProdutos)}" update="graficoSaida" />
                            </div>  

                            <div class="wizardBack">
                                <p:commandButton image="voltar" title="Voltar" action="#{graficoSaida.navegaNoWizard(4)}" update="graficoSaida" />
                            </div> 
                        </div>
                    </p:panel>
                </p:tab>
                <!--PONTOS-->
                <p:tab title="Pontos" id="pontos"  >
                    <p:panel header="Definindo os pontos">
                        <table border="0">
                            <tr>
                                <td ><h:outputText value="Pontos "/></td>
                                <td >
                                    <p:selectOneMenu value="#{listaDePontos.indexDoPonto}" style="min-width: 230px;" >
                                        <f:selectItems var="p" value="#{listaDePontos.pontos}" itemLabel="#{p.nome}"
                                                       itemValue="#{listaDePontos.pontos.indexOf(p)}" >
                                        </f:selectItems>
                                    </p:selectOneMenu>
                                </td>
                            </tr>
                            <tr>
                                <td/>
                                <td>
                                    <p:commandButton value="Adicionar Ponto" action="#{listaDePontos.desce()}" update="graficoSaida" />
                                </td>
                            </tr>
                        </table>
                        <p:dataTable var="p" value="#{listaDePontos.pontosManipulados}" 
                                     paginator="true" rows="10" emptyMessage="Sem resultados"
                                     paginatorTemplate="  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15,30"  >
                            <f:facet name="header" >
                                Lista de produtos
                            </f:facet>




                            <p:column  >
                                <f:facet name="header" >  
                                    <div class="cabecaTablea">Nome</div>
                                </f:facet>
                                <div class="espacamento" >
                                    <h:outputText value="#{p.nome}" />
                                </div>
                            </p:column>


                            <p:column style="text-align: center;">
                                <f:facet name="header" >  
                                    <div class="cabecaTablea">Remover</div>
                                </f:facet>
                                <div class="espacamento" >
                                    <p:commandLink id="removerPonto" action="#{boleanos.ambosTrue(2)}" oncomplete="breuOn();abreJanela2();" update="removePonto" >
                                        <p:tooltip for="removerPonto" value="Remover ponto"/>
                                        <h:graphicImage library="imagens" name="delete.png" />
                                        <f:setPropertyActionListener value="#{listaDePontos.pontosManipulados.indexOf(p)}" target="#{listaDePontos.indexDoPontoManipulado}"/>
                                    </p:commandLink>
                                </div>
                            </p:column>
                        </p:dataTable>
                        <p:separator style="width: 100%; height: 5px;"/>
                        <div class="wizard">
                            <div class="wizardNext">
                                <p:commandButton image="avancar" title="Avançar" action="#{graficoSaida.conferePontos(listaDePontos,listaDeProdutos,listaDeGraficosSaidaSalvos)}" update="graficoSaida" />
                            </div>  
                            <div class="wizardBack">
                                <p:commandButton image="voltar" title="Voltar" action="#{graficoSaida.navegaNoWizard(6)}" update="graficoSaida" />
                            </div> 
                        </div>
                    </p:panel>
                </p:tab>
                <!--GRAFICO-->
                <p:tab title="Grafico" id="grafico" >
                    <p:panel header="Exibindo gráfico">

                        <p><p:commandButton value="Salvar consulta" action="#{boleanos.ambosTrue(3)}"  rendered="#{!listaDeGraficosSaidaSalvos.confereSeABSGrafSaidaSalvoJahTahSalvo()}" oncomplete="breuOn();abreJanela3();"  update="salvarGraf" /></p>
                        <p><p:commandButton value="Salvar consulta" action="#{boleanos.ambosTrue(5)}" rendered="#{listaDeGraficosSaidaSalvos.confereSeABSGrafSaidaSalvoJahTahSalvo()}" oncomplete="breuOn();abreJanela5();iniciaAlinhamentoBurro();" update="configGrafManipulado"  /></p>

                        <!-- TODOS OS PONTOS -->
                        <p:fieldset id="todosOsPontos" legend="Todos os pontos"  collapsed="true" toggleable="true" toggleSpeed="#{boleanos.timeDefault*2}"  >
                            <p:commandLink id="todosOsPontosColuna" update="todosOsPontos" >
                                <p:tooltip for="todosOsPontosColuna" value="Visualizar gráfico em coluna" />
                                <h:graphicImage library="imagens" name="chart32.png"></h:graphicImage>
                                <f:setPropertyActionListener value="MSColumn3D" target="#{graficoSaida.tipoGrafico}" />
                                <f:setPropertyActionListener value="#FFF" target="#{graficoSaida.cor}" />
                            </p:commandLink>
                            <p:commandLink id="todosOsPontosEmLinha" update="todosOsPontos" style="margin-left: 8px;"   >
                                <p:tooltip for="todosOsPontosEmLinha" value="Visualizar gráfico em linha" />
                                <h:graphicImage library="imagens" name="chartline32.png"  ></h:graphicImage>
                                <f:setPropertyActionListener value="MSLine" target="#{graficoSaida.tipoGrafico}" />
                                <f:setPropertyActionListener value="#f8fafb" target="#{graficoSaida.cor}" />
                            </p:commandLink>
                            <div id="escondeMerchan" style="position: relative; margin-bottom: -20px; width: 210px; height: 20px;  background-color: #{graficoSaida.cor}; padding-right: -15px;  " />
                            <object type="application/x-shockwave-flash" lang="PT" class="FusionCharts" data="aplicativo/#{graficoSaida.tipoGrafico}.swf" width="100%" height="400" id="chart2c" style="visibility: visible; ">
                                <param name="scaleMode" value="noScale"/>
                                <param name="scale" value="noScale"/>
                                <param name="wMode" value="transparent"/>
                                <param name="allowScriptAccess" value="always"/>
                                <param name="bgSWF" value="1441459.png"/>
                                <param name="bgSWFAlpha" value="40"/>
                                <param name="quality" value="best"/>
                                <param name="flashvars" value="dataURL=xml/grafico.xml"/>
                            </object>
                            <p:fieldset legend="Dados " collapsed="true" toggleable="true" toggleSpeed="#{boleanos.timeDefault*2}"  >
                                <p:dataTable  var="ds" value="#{graficoSaida.geradorXml.listDataSetSaida}" 
                                              paginator="true" rows="10" emptyMessage="Sem resultados"
                                              paginatorTemplate="  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                              rowsPerPageTemplate="5,10,15,30" >  
                                    <f:facet name="header">
                                        Lista de produtos
                                    </f:facet>
                                    <p:columnGroup type="header">  
                                        <p:row>  
                                            <p:column headerText="Periodo" styleClass="cabecaTablea"  /> 
                                            <p:column headerText="Quantidade" styleClass="cabecaTablea" /> 
                                        </p:row>  
                                    </p:columnGroup>  
                                    <p:subTable var="v" value="#{ds.valores}"   >  
                                        <f:facet name="header" >  
                                            <div class="cabecaSubTabela" > #{ds.nome}   </div>
                                        </f:facet> 
                                        <p:column>  
                                            <div class="#{utilLista.linha(true)}" >
                                                #{graficoSaida.geradorXml.verData(graficoSaida.tipoDeConsulta)}</div>
                                        </p:column>  
                                        <p:column>  
                                            <div class="#{utilLista.linha(false)}" >#{v}</div>  
                                        </p:column>  
                                    </p:subTable>
                                </p:dataTable>
                            </p:fieldset>
                        </p:fieldset>
                        <!--PONTOS DISTINTOS-->
                        <h:dataTable id="tabelaPontosDistintos" var="p" value="#{listaDePontos.pontosManipulados}" width="100%" >
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Movimentação de cada ponto" />
                                </f:facet>
                                <!-- PONTOS DISTINTOS -->
                                <p><p:fieldset  id="filedSet" legend="#{p.nome}" collapsed="true" toggleable="true" toggleSpeed="#{boleanos.timeDefault*2}"  >
                                        <p:commandLink id="graficoEmColuna" 
                                                       onclick="PrimeFaces.ab({formId:'graficoSaida',source:'tabelaPontosDistintos:#{listaDePontos.pontosManipulados.indexOf(p)}:graficoEmColuna',process:'@all',update:'tabelaPontosDistintos:#{listaDePontos.pontosManipulados.indexOf(p)}:outputGrafico'});">
                                            <h:graphicImage id="imagemColuna" library="imagens" name="chart32.png"></h:graphicImage>
                                            <p:tooltip for="imagemColuna" value="Visualizar gráfico em linha" />
                                            <f:setPropertyActionListener value="MSColumn3D" target="#{graficoSaida.tipoGrafico}" />
                                            <f:setPropertyActionListener value="#FFF" target="#{graficoSaida.cor}" />
                                        </p:commandLink>
                                        <p:commandLink id="graficoEmLinha" style="margin-left: 8px;"
                                                       onclick="PrimeFaces.ab({formId:'graficoSaida',source:'tabelaPontosDistintos:#{listaDePontos.pontosManipulados.indexOf(p)}:graficoEmLinha',process:'@all',update:'tabelaPontosDistintos:#{listaDePontos.pontosManipulados.indexOf(p)}:outputGrafico'});">
                                            <h:graphicImage id="imagemLinha" library="imagens" name="chartline32.png"  />
                                            <p:tooltip for="imagemLinha" value="Visualizar gráfico em linha" />
                                            <f:setPropertyActionListener value="MSLine" target="#{graficoSaida.tipoGrafico}" />
                                            <f:setPropertyActionListener value="#f8fafb" target="#{graficoSaida.cor}" />
                                        </p:commandLink>
                                        <p:outputPanel id="outputGrafico">
                                            <div id="escondeMerchan" style="position: relative; margin-bottom: -20px; width: 210px; height: 20px;  background-color: #{graficoSaida.cor}; padding-right: -15px;  " />
                                            <object type="application/x-shockwave-flash" lang="PT"  class="FusionCharts" data="aplicativo/#{graficoSaida.tipoGrafico}.swf" width="100%" height="400" id="chart2c" style="visibility: visible; ">
                                                <param name="scaleMode" value="noScale"/>
                                                <param name="scale" value="noScale"/>
                                                <param name="wMode" value="transparent"/>
                                                <param name="allowScriptAccess" value="always"/>
                                                <param name="quality" value="best"/>
                                                <param name="flashvars" value="dataURL=xml/grafico#{p.id}.xml"/>
                                            </object>
                                        </p:outputPanel>
                                        <p:fieldset legend="Dados " collapsed="true" toggleable="true" toggleSpeed="#{boleanos.timeDefault*2}"  >
                                            <p:dataTable  var="dss" value="#{graficoSaida.geradorXml.dataSetDoPonto(listaDeProdutos.produtosManipulados,p)}" 
                                                          paginator="true" rows="10" emptyMessage="Sem resultados"
                                                          paginatorTemplate="  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                          rowsPerPageTemplate="5,10,15,30" >  
                                                <f:facet name="header">
                                                    Lista de produtos
                                                </f:facet>
                                                <p:columnGroup type="header">  
                                                    <p:row>  
                                                        <p:column headerText="Periodo" styleClass="cabecaTablea" /> 
                                                        <p:column headerText="Quantidade" styleClass="cabecaTablea" /> 
                                                    </p:row>  
                                                </p:columnGroup>  
                                                <p:subTable var="v"  value="#{dss.valores}"  >  
                                                    <f:facet name="header"  >  
                                                        <div class="cabecaSubTabela" > #{dss.nome} </div>   
                                                    </f:facet> 

                                                    <p:column> 
                                                        <div class="#{utilLista.linha(true)}" >
                                                            #{graficoSaida.geradorXml.verData(graficoSaida.tipoDeConsulta)}  </div>
                                                    </p:column>  
                                                    <p:column  > 
                                                        <div class="#{utilLista.linha(false)}" >#{v}  </div>
                                                    </p:column>  

                                                </p:subTable>
                                            </p:dataTable>
                                        </p:fieldset>
                                    </p:fieldset></p>
                            </p:column>
                        </h:dataTable>
                        <p:separator style="width: 100%; height: 5px;"/>
                        <div class="wizard">
                            <div class="wizardBack">
                                <p:commandButton image="voltar" title="Voltar"  actionListener="#{graficoSaida.navegaNoWizard(7)}"  update="graficoSaida" />
                            </div> 
                        </div>
                    </p:panel>
                </p:tab>
            </p:wizard>
        </h:form>



        <h:form id="deletaGraf" prependId="false" >
            <p:outputPanel rendered="#{boleanos.verA(0)}" styleClass="outputpanel"  >
                <div class="janelaRolavel" id="janelaRolavel0"  >
                    <p:panel header="Deletando gráfico" id="janela0" styleClass="janelas" >
                        <p>Deletar gráfico "#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerDeletado.nome}" -
                            #{utilData.dataFormal2(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerDeletado.dataModificado.time)} </p>
                        <p:commandButton image="voltar2" style="margin-right: 10px;" actionListener="#{boleanos.mudaA(0, boleanos.timeDefault)}"
                                         onstart="fechaJanela0();breuOff();" update="deletaGraf"  />

                        <p:commandButton image="deletar" action="#{listaDeGraficosSaidaSalvos.deletaGrafSaida()}"
                                         actionListener="#{boleanos.mudaA(0, boleanos.timeDefault)}" onstart="fechaJanela0();breuOff();"
                                         update="graficoSaida"  />
                    </p:panel>
                </div>
            </p:outputPanel>
        </h:form>

        <h:form id="removeProduto" prependId="false">
            <p:outputPanel rendered="#{boleanos.verA(1)}" styleClass="outputpanel" >
                <div class="janelaRolavel" id="janelaRolavel1">
                    <p:panel header="Remover produto" id="janela1" styleClass="janelas" >
                        <p>
                            Remover da lista "#{listaDeProdutos.produtoManipuladoIndexado.nome}" ?</p>
                        <p:commandButton image="voltar2" style="margin-right: 10px;"  action="#{boleanos.mudaA(1, boleanos.timeDefault)}" onstart="fechaJanela1();breuOff();"
                                         update="removeProduto"  />
                        <p:commandButton image="deletar" action="#{listaDeProdutos.sobeManipulado()}" actionListener="#{boleanos.mudaA(1, boleanos.timeDefault)}"
                                         update="removeProduto,graficoSaida" onstart="fechaJanela1();breuOff();"  />
                    </p:panel>
                </div>
            </p:outputPanel>
        </h:form>

        <h:form id="removePonto" prependId="false"  >
            <p:outputPanel rendered="#{boleanos.verA(2)}" styleClass="outputpanel" >
                <div class="janelaRolavel" id="janelaRolavel2">
                    <p:panel header="Remover ponto" id="janela2" styleClass="janelas" >
                        <p>Remover da lista "#{listaDePontos.pontoManipualdoIndexado.nome}" ?</p>
                        <p:commandButton image="voltar2"  style="margin-right: 10px;"  action="#{boleanos.ambosFalse(2,  boleanos.timeDefault)}" onstart="breuOff();fechaJanela2();" update="graficoSaida"  /> 
                        <p:commandButton image="deletar" action="#{listaDePontos.sobeIndexado()}" actionListener="#{boleanos.ambosFalse(2,  boleanos.timeDefault)}"
                                         update="graficoSaida,removePonto" onstart="breuOff();fechaJanela2();"  />
                    </p:panel>
                </div>
            </p:outputPanel>
        </h:form>

        <h:form id="salvarGraf" prependId="false"  >
            <p:outputPanel rendered="#{boleanos.verA(3)}" styleClass="outputpanel" >
                <div class="janelaRolavel" id="janelaRolavel3">
                    <p:panel header="Salvar gráfico" id="janela3" styleClass="janelas" >
                        <div id="breuJanela3" class="breu" ></div>
                        <table>
                            <tr>    
                                <td class="alingRight" >Nome</td>
                                <td colspan="2" ><p:inputText value="#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}" /> </td>
                            </tr>
                            <tr>
                                <td><p:commandButton image="voltar2" action="#{boleanos.ambosFalse(3, boleanos.timeDefault)}" onstart="breuOff();fechaJanela3();" update="salvarGraf"  /> </td>
                                <td>
                                    <p:commandButton title="Salvar consutla como nova" action="#{graficoSaida.primeiroPassoSalvarConsultaComoNova(listaDePontos, listaDeProdutos, listaDeGraficosSaidaSalvos, boleanos)}"
                                                     oncomplete="nomeRepetido(args);" update="confirmaSalvarGraficoComNomeRepetido,graficoSaida" image="salvar" />
                                </td>
                            </tr>
                        </table>
                    </p:panel>
                </div>
            </p:outputPanel>
        </h:form>

        <h:form id="confirmaSalvarGraficoComNomeRepetido" prependId="false"  >
            <p:outputPanel rendered="#{boleanos.verA(4)}" styleClass="outputpanel" >
                <div class="janelaRolavel" id="janelaRolavel4">
                    <p:panel header="Nome repetido" id="janela4" styleClass="janelas" >
                        <div id="breuJanela4" class="breu" ></div>

                        <p>Já exsite um gráfico salvo com este nome!<br></br>
                            Você pode voltar e escolher um novo nome, ou atualizar o gráfico "#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}" </p>
                        Novo nome: <p:inputText value="#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}" /> <br></br>
                        <p:commandButton image="voltar2" actionListener="#{boleanos.ambosFalse(4, boleanos.timeDefault)}" onstart="fechaJanela4();breuNaJanelaOff('breuJanela3')"
                                         update="confirmaSalvarGraficoComNomeRepetido"  />
                        <p:commandButton image="diferenca" title="ver diferença entre o grafico q eu desejo salvar e o grafico já salvo"
                                         actionListener="#{boleanos.ambosTrue(6)}" oncomplete="breuOnNaJanela('breuJanela4');abreJanela6();iniciaAlinhamentoBurro();" update="verDiferenca"/>
                        <p:commandButton image="salvar" action="#{graficoSaida.salvaConsultaComoNova(listaDePontos, listaDeProdutos, listaDeGraficosSaidaSalvos, boleanos)}"  />

                        <p:commandButton title="Atualizar Consulta" image="update" update="confirmaSalvarGraficoComNomeRepetido,graficoSaida,salvarGraf"
                                         action="#{graficoSaida.tentaAtualizarGraficoManipulado(listaDeGraficosSaidaSalvos, listaDeProdutos, listaDePontos)}"
                                         actionListener="#{boleanos.ambosFalse(4, 3,boleanos.timeDefault)}"
                                         onstart="fechaJanela4();breuNaJanelaOff('breuJanela3');setTimeout('fechaJanela3();breuOff();',tempoDafault);" />
                    </p:panel>
                </div>
            </p:outputPanel>
        </h:form>

        <h:form id="configGrafManipulado" prependId="false"  >
            <p:outputPanel rendered="#{boleanos.verA(5)}" styleClass="outputpanel" >
                <div class="janelaRolavel" id="janelaRolavel5">
                    <p:panel header="Gráfico manipulado" id="janela5" styleClass="janelas" >
                        <div id="breuJanela5" class="breu" ></div>
                        <p><p:dataTable style="text-align: center" id="tabela2" var="a" value="#{utilLista.recebeObjetoRetornaLista(boleanos.meVeUmFalse())}">  
                                <f:facet name="header">
                                    <div class="cabecaTablea">Gráfico "#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}"</div>
                                </f:facet>
                                <p:column  >
                                    <f:facet name="header" >  
                                        <div class="cabecaTablea">Salvo</div>
                                    </f:facet>
                                    <div class="espacamento" >
                                        <p>
                                            De #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaDe(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.de.time,listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.agrupamento)}<br></br>
                                            Até #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaAte(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.ate.time,listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.agrupamento)}<br></br>
                                            Agrupamento #{listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.agrupamento}</p>
                                        <p:accordionPanel activeIndex="-1" >
                                            <p:tab title="Produtos" id="idDaTabProdutos">
                                                <p:dataTable var="xProduto" value="#{listaDeGraficosSaidaSalvos.listaProdutosDeGraficoSalvo(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado)}">  
                                                    <p:column>
                                                        #{xProduto.toString()}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                        <br></br>
                                        <p:accordionPanel activeIndex="-1" >
                                            <p:tab title="Pontos" id="idDaTabProdutos">
                                                <p:dataTable var="xPonto" value="#{listaDeGraficosSaidaSalvos.listaPontosDeGraficoSalvo(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado)}">  
                                                    <p:column>
                                                        #{xPonto.nome}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                    </div>
                                </p:column>

                                <p:column  >
                                    <f:facet name="header" >  
                                        <div class="cabecaTablea">Atual</div>
                                    </f:facet>
                                    <div class="espacamento" >
                                        <p>
                                            De #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaDe(listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).de.time,listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).agrupamento)}<br></br>
                                            Até #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaAte(listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).ate.time,listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).agrupamento)}<br></br>
                                            Agrupamento #{listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).agrupamento}</p>
                                        <p:accordionPanel activeIndex="-1" >
                                            <p:tab title="Produtos" >
                                                <p:dataTable var="xProdutoManipulado" value="#{listaDeProdutos.produtosManipulados}">  
                                                    <p:column>
                                                        #{xProdutoManipulado.toString()}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                        <br></br>
                                        <p:accordionPanel activeIndex="-1">
                                            <p:tab title="Pontos"  >
                                                <p:dataTable var="xPontoManipulado" value="#{listaDePontos.pontosManipulados}">  
                                                    <p:column>
                                                        #{xPontoManipulado.nome}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                    </div>
                                </p:column>
                            </p:dataTable></p>

                        Novo nome: <p:inputText value="#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}" /> <br></br>
                        <p:commandButton image="voltar2" action="#{boleanos.ambosFalse(5, boleanos.timeDefault)}" onstart="fechaJanela5();breuOff();" update="configGrafManipulado" />
                        <p:commandButton image="salvar" action="#{graficoSaida.salvaConsultaComoNova(listaDePontos, listaDeProdutos, listaDeGraficosSaidaSalvos, boleanos)}" oncomplete="salvarGraficoManipulado(args);" update="graficoSaida" />
                        <p:commandButton image="update" action="#{graficoSaida.tentaAtualizarGraficoManipulado(listaDeGraficosSaidaSalvos, listaDeProdutos, listaDePontos)}" actionListener="#{boleanos.ambosFalse(5, boleanos.timeDefault)}" onstart="fechaJanela5();breuOff();" update="configGrafManipulado,graficoSaida,salvarGraf" />
                        <p:commandButton image="clear" actionListener="#{boleanos.ambosFalse(5, boleanos.timeDefault)}" action="#{listaDeGraficosSaidaSalvos.limpaSessaoGraficoSalvoManipulado()}" onstart="fechaJanela5();breuOff();" update="configGrafManipulado,graficoSaida" />
                    </p:panel></div>
            </p:outputPanel>
        </h:form>

        <!--ver a diferença entre o gráfico que está tentando salvar com um nome já existe, com o gráfico respectivo do nome existente-->
        <h:form id="verDiferenca" prependId="false"  >
            <p:outputPanel rendered="#{boleanos.verA(6)}" styleClass="outputpanel" >
                <div class="janelaRolavel" id="janelaRolavel6">
                    <p:panel header="Diferença entre os gráficos" id="janela6" styleClass="janelas" >
                        <p><p:dataTable style="text-align: center" id="tabela" var="a" value="#{utilLista.recebeObjetoRetornaLista(boleanos.meVeUmFalse())}">  
                                <f:facet name="header">
                                    #{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}
                                </f:facet> 

                                <p:column  >
                                    <f:facet name="header" >  
                                        <div class="cabecaTablea">Salvo</div>
                                    </f:facet>
                                    <div class="espacamento" >
                                        <p>
                                            De #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaDe(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.de.time,listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.agrupamento)}<br></br>
                                            Até #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaAte(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.ate.time,listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.agrupamento)}<br></br>
                                            Agrupamento #{listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado.agrupamento}</p>
                                        <p:accordionPanel activeIndex="-1" >
                                            <p:tab title="Produtos" id="idDaTabProdutos">
                                                <p:dataTable var="xProduto" value="#{listaDeGraficosSaidaSalvos.listaProdutosDeGraficoSalvo(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado)}">  
                                                    <p:column>
                                                        #{xProduto.toString()}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                        <br></br>
                                        <p:accordionPanel activeIndex="-1" >
                                            <p:tab title="Pontos" id="idDaTabProdutos">
                                                <p:dataTable var="xPonto" value="#{listaDeGraficosSaidaSalvos.listaPontosDeGraficoSalvo(listaDeGraficosSaidaSalvos.absGrafSaidaSalvoPraSerManipulado)}">  
                                                    <p:column>
                                                        #{xPonto.nome}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                    </div>
                                </p:column>

                                <p:column  >
                                    <f:facet name="header" >  
                                        <div class="cabecaTablea">Atual</div>
                                    </f:facet>
                                    <div class="espacamento" >
                                        <p>
                                            De #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaDe(listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).de.time,listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).agrupamento)}<br></br>
                                            Até #{utilData.dataFormatadaParaExibicaoSegundoCategoriaPreDeterminadaAte(listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).ate.time,listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).agrupamento)}<br></br>
                                            Agrupamento #{listaDeGraficosSaidaSalvos.graficoManipulado(graficoSaida.tipoDeConsulta).agrupamento}</p>
                                        <p:accordionPanel activeIndex="-1" >
                                            <p:tab title="Produtos" >
                                                <p:dataTable var="xProdutoManipulado" value="#{listaDeProdutos.produtosManipulados}">  
                                                    <p:column>
                                                        #{xProdutoManipulado.toString()}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                        <br></br>
                                        <p:accordionPanel activeIndex="-1">
                                            <p:tab title="Pontos"  >
                                                <p:dataTable var="xPontoManipulado" value="#{listaDePontos.pontosManipulados}">  
                                                    <p:column>
                                                        #{xPontoManipulado.nome}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                    </div>
                                </p:column>
                            </p:dataTable></p>
                        Novo nome: <p:inputText value="#{listaDeGraficosSaidaSalvos.absGrafSaidaSalvo.nome}" /> <br></br>
                        <p:commandButton image="voltar2" actionListener="#{boleanos.ambosFalse(6, boleanos.timeDefault)}" onstart="fechaJanela6();breuNaJanelaOff('breuJanela4')"
                                         update="verDiferenca"  />
                        <p:commandButton title="Salvar consutla como nova" action="#{graficoSaida.salvaConsultaComoNova(listaDePontos, listaDeProdutos, listaDeGraficosSaidaSalvos, boleanos)}"
                                         oncomplete="verDiferencaSalvarComoNovo(args);" image="salvar"  />
                        <p:commandButton image="update" action="#{graficoSaida.tentaAtualizarGraficoManipulado(listaDeGraficosSaidaSalvos, listaDeProdutos, listaDePontos)}"
                                         actionListener="#{boleanos.ambosFalse(5, 4, 3, boleanos.timeDefault)}" update="graficoSaida"
                                         onstart="fechaJanelas();"/>
                    </p:panel>
                </div>
            </p:outputPanel>
        </h:form>


        <p:ajaxStatus>
            <f:facet name="start">
                <div class="loading"/> 
            </f:facet>
            <f:facet name="complete">
                <div class="complete"/> 
            </f:facet>
            <f:facet name="error">
                <div class="erro2"/>
            </f:facet>
            <f:facet name="onsuccess">
            </f:facet>
            <f:facet name="onselectStart">
                <div class="erro2"/>
            </f:facet>
            <f:facet name="onselectComplete">
                <div class="erro2"/>
            </f:facet>
        </p:ajaxStatus>
        <script type="text/javascript" >
            function nomeRepetido(args){
                if(args.nomeRepetido){
                    breuOnNaJanela('breuJanela3');
                    abreJanela4();
                }else{
                    breuOff();fechaJanela3();
                } 
            }
            function fechaJanelas(){
                fechaJanela6();
                breuNaJanelaOff('breuJanela4');
                setTimeout("fechaJanela4();breuNaJanelaOff('breuJanela3');",tempoDafault*1.2);
                setTimeout('breuOff();fechaJanela3();',tempoDafault*2.4);
            }
            function salvarGraficoManipulado(args){
                if(args.fechaJanela){
                    fechaJanela5();
                    breuOff();
                }
            }
            function verDiferencaSalvarComoNovo(args){
                if(args.fechaJanela){
                    fechaJanela6();
                    breuNaJanelaOff('breuJanela4');
                    setTimeout("fechaJanela4();breuNaJanelaOff('breuJanela3')",tempoDafault*1.2);
                    setTimeout('fechaJanela3();breuOff();',tempoDafault*2.4);
                }
            }
        </script>
    </ui:define>

</ui:composition>
